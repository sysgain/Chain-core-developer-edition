{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Compute.MultiVm",
  "version": "0.1.2-preview",
  "parameters": {
    "basics": [
      {
        "name": "basics",
        "type": "Microsoft.Common.Section",
        "label": "Basic configurations",
        "elements": [
          {
            "name": "adminUsername",
            "type": "Microsoft.Compute.UserNameTextBox",
            "label": "User name",
            "defaultValue": "chainuser",
            "toolTip": "Admin username for all of the deployed virtual machines.",
            "osPlatform": "Linux",
            "visible": true
          },
          {
            "name": "adminCredentials",
            "type": "Microsoft.Compute.CredentialsCombo",
            "label": {
              "authenticationType": "Authentication type",
              "password": "Password",
              "confirmPassword": "Confirm password",
              "sshPublicKey": "SSH public key"
            },
            "toolTip": {
              "authenticationType": "Authentication type for the admin user",
              "password": "VM password must be 12 characters and have 3 of the following: 1 lower case character, 1 upper case character, 1 number, and 1 special character.",
              "sshPublicKey": "Virtual machine SSH public key"
            },
            "constraints": {
              "required": true
            },
            "options": {
              "hideConfirmation": false
            },
            "osPlatform": "Linux",
            "visible": true
          }
        ],
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "regCnt",
        "label": "Deployment regions",
        "bladeTitle": "Deployment regions",
        "subLabel": {
          "preValidation": "Required",
          "postValidation": "Done"
        },
        "elements": [
          {
            "name": "regionCnt",
            "type": "Microsoft.Common.DropDown",
            "label": "Number of region(s)",
            "toolTip": "Select the number of region(s) to deploy virtual machines into.",
            "defaultValue": "1",
            "constraints": {
              "allowedValues": [
                {
                  "label": "1",
                  "value": 1
                },
                {
                  "label": "2",
                  "value": 2
                },
                {
                  "label": "3",
                  "value": 3
                }
              ]
            },
            "visible": true
          },
          {
            "name": "loc1",
            "type": "Microsoft.Common.DropDown",
            "label": "First region",
            "toolTip": "Select the first region.",
            "defaultValue": "West US",
            "constraints": {
              "allowedValues": [
                {
                  "label": "Australia East",
                  "value": "australiaeast"
                },
                {
                  "label": "Australia Southeast",
                  "value": "australiasoutheast"
                },
                {
                  "label": "Brazil South",
                  "value": "brazilsouth"
                },
                {
                  "label": "Canada Central",
                  "value": "canadacentral"
                },
                {
                  "label": "Canada East",
                  "value": "canadaeast"
                },
                {
                  "label": "Central India",
                  "value": "centralindia"
                },
                {
                  "label": "Central US",
                  "value": "centralus"
                },
                {
                  "label": "East Asia",
                  "value": "eastasia"
                },
                {
                  "label": "East US",
                  "value": "eastus"
                },
                {
                  "label": "East US 2",
                  "value": "eastus2"
                },
                {
                  "label": "Japan East",
                  "value": "japaneast"
                },
                {
                  "label": "Japan West",
                  "value": "japanwest"
                },
                {
                  "label": "Korea Central",
                  "value": "koreacentral"
                },
                {
                  "label": "Korea South",
                  "value": "koreasouth"
                },
                {
                  "label": "North Central US",
                  "value": "northcentralus"
                },
                {
                  "label": "North Europe",
                  "value": "northeurope"
                },
                {
                  "label": "South Central US",
                  "value": "southcentralus"
                },
                {
                  "label": "South India",
                  "value": "southindia"
                },
                {
                  "label": "Southeast Asia",
                  "value": "southeastasia"
                },
                {
                  "label": "UK South",
                  "value": "uksouth"
                },
                {
                  "label": "UK West",
                  "value": "ukwest"
                },
                {
                  "label": "West Central US",
                  "value": "westcentralus"
                },
                {
                  "label": "West Europe",
                  "value": "westeurope"
                },
                {
                  "label": "West US",
                  "value": "westus"
                },
                {
                  "label": "West US 2",
                  "value": "westus2"
                }
              ]
            },
            "visible": true
          },
          {
            "name": "loc2",
            "type": "Microsoft.Common.DropDown",
            "label": "Second region",
            "toolTip": "Select the second region.",
            "defaultValue": "East US",
            "constraints": {
              "allowedValues": [
                {
                  "label": "Australia East",
                  "value": "australiaeast"
                },
                {
                  "label": "Australia Southeast",
                  "value": "australiasoutheast"
                },
                {
                  "label": "Brazil South",
                  "value": "brazilsouth"
                },
                {
                  "label": "Canada Central",
                  "value": "canadacentral"
                },
                {
                  "label": "Canada East",
                  "value": "canadaeast"
                },
                {
                  "label": "Central India",
                  "value": "centralindia"
                },
                {
                  "label": "Central US",
                  "value": "centralus"
                },
                {
                  "label": "East Asia",
                  "value": "eastasia"
                },
                {
                  "label": "East US",
                  "value": "eastus"
                },
                {
                  "label": "East US 2",
                  "value": "eastus2"
                },
                {
                  "label": "Japan East",
                  "value": "japaneast"
                },
                {
                  "label": "Japan West",
                  "value": "japanwest"
                },
                {
                  "label": "Korea Central",
                  "value": "koreacentral"
                },
                {
                  "label": "Korea South",
                  "value": "koreasouth"
                },
                {
                  "label": "North Central US",
                  "value": "northcentralus"
                },
                {
                  "label": "North Europe",
                  "value": "northeurope"
                },
                {
                  "label": "South Central US",
                  "value": "southcentralus"
                },
                {
                  "label": "South India",
                  "value": "southindia"
                },
                {
                  "label": "Southeast Asia",
                  "value": "southeastasia"
                },
                {
                  "label": "UK South",
                  "value": "uksouth"
                },
                {
                  "label": "UK West",
                  "value": "ukwest"
                },
                {
                  "label": "West Central US",
                  "value": "westcentralus"
                },
                {
                  "label": "West Europe",
                  "value": "westeurope"
                },
                {
                  "label": "West US",
                  "value": "westus"
                },
                {
                  "label": "West US 2",
                  "value": "westus2"
                }
              ]
            },
            "visible": "[greaterOrEquals(steps('regCnt').regionCnt, 2)]"
          },
          {
            "name": "loc3",
            "type": "Microsoft.Common.DropDown",
            "label": "Third region",
            "toolTip": "Select the third region.",
            "defaultValue": "Central US",
            "constraints": {
              "allowedValues": [
                {
                  "label": "Australia East",
                  "value": "australiaeast"
                },
                {
                  "label": "Australia Southeast",
                  "value": "australiasoutheast"
                },
                {
                  "label": "Brazil South",
                  "value": "brazilsouth"
                },
                {
                  "label": "Canada Central",
                  "value": "canadacentral"
                },
                {
                  "label": "Canada East",
                  "value": "canadaeast"
                },
                {
                  "label": "Central India",
                  "value": "centralindia"
                },
                {
                  "label": "Central US",
                  "value": "centralus"
                },
                {
                  "label": "East Asia",
                  "value": "eastasia"
                },
                {
                  "label": "East US",
                  "value": "eastus"
                },
                {
                  "label": "East US 2",
                  "value": "eastus2"
                },
                {
                  "label": "Japan East",
                  "value": "japaneast"
                },
                {
                  "label": "Japan West",
                  "value": "japanwest"
                },
                {
                  "label": "Korea Central",
                  "value": "koreacentral"
                },
                {
                  "label": "Korea South",
                  "value": "koreasouth"
                },
                {
                  "label": "North Central US",
                  "value": "northcentralus"
                },
                {
                  "label": "North Europe",
                  "value": "northeurope"
                },
                {
                  "label": "South Central US",
                  "value": "southcentralus"
                },
                {
                  "label": "South India",
                  "value": "southindia"
                },
                {
                  "label": "Southeast Asia",
                  "value": "southeastasia"
                },
                {
                  "label": "UK South",
                  "value": "uksouth"
                },
                {
                  "label": "UK West",
                  "value": "ukwest"
                },
                {
                  "label": "West Central US",
                  "value": "westcentralus"
                },
                {
                  "label": "West Europe",
                  "value": "westeurope"
                },
                {
                  "label": "West US",
                  "value": "westus"
                },
                {
                  "label": "West US 2",
                  "value": "westus2"
                }
              ]
            },
            "visible": "[equals(steps('regCnt').regionCnt, 3)]"
          }
        ]
      },
      {
        "name": "vmCount",
        "bladeTitle": "Network size and performance",
        "label": "Network size and performance",
        "subLabel": {
          "preValidation": "Required",
          "postValidation": "Done"
        },
        "elements": [
          {
            "name": "vmCountReg1",
            "type": "Microsoft.Common.Section",
            "label": "Region 1 instance count",
            "elements": [
              {
                "name": "signerVmCountReg1",
                "type": "Microsoft.Common.DropDown",
                "label": "Number of signer chain core instances",
                "defaultValue": "1",
                "toolTip": "Select the number of signer chain core instances to deploy into Region 1",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "0",
                      "value": 0
                    },
                    {
                      "label": "1",
                      "value": 1
                    },
                    {
                      "label": "2",
                      "value": 2
                    },
                    {
                      "label": "3",
                      "value": 3
                    }
                  ]
                },
                "visible": true
              },
              {
                "name": "partVmCountReg1",
                "type": "Microsoft.Common.DropDown",
                "label": "Number of participant chain core instances",
                "defaultValue": "1",
                "toolTip": "Select the number of participant chain core instances to deploy into Region 1",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "0",
                      "value": 0
                    },
                    {
                      "label": "1",
                      "value": 1
                    },
                    {
                      "label": "2",
                      "value": 2
                    },
                    {
                      "label": "3",
                      "value": 3
                    }
                  ]
                },
                "visible": true
              }
            ],
            "visible": true
          },
          {
            "name": "vmCountReg2",
            "type": "Microsoft.Common.Section",
            "label": "Region 2 instance count",
            "elements": [
              {
                "name": "signerAndParticpantVmCountReg2",
                "type": "Microsoft.Common.DropDown",
                "label": "Number of signer and participant chain core instances",
                "defaultValue": "0 Signer and 1 Participant",
                "toolTip": "Select the number of signer and participant chain core instances to deploy into Region 2",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "0 Signer and 1 Participant",
                      "value": "01"
                    },
                    {
                      "label": "1 Signer and 0 Participant",
                      "value": "10"
                    },
                    {
                      "label": "1 Signer and 1 Participant",
                      "value": "11"
                    }
                  ]
                },
                "visible": "[greaterOrEquals(steps('regCnt').regionCnt, 2)]"
              }
            ],
            "visible": "[greaterOrEquals(steps('regCnt').regionCnt, 2)]"
          },
          {
            "name": "vmCountReg3",
            "type": "Microsoft.Common.Section",
            "label": "Region 3 instance count",
            "elements": [
              {
                "name": "signerAndParticpantVmCountReg3",
                "type": "Microsoft.Common.DropDown",
                "label": "Number of signer and participant chain core instances",
                "defaultValue": "0 Signer and 1 Participant",
                "toolTip": "Select the number of signer and participant chain core instances to deploy into Region 3",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "0 Signer and 1 Participant",
                      "value": "01"
                    },
                    {
                      "label": "1 Signer and 0 Participant",
                      "value": "10"
                    },
                    {
                      "label": "1 Signer and 1 Participant",
                      "value": "11"
                    }
                  ]
                },
                "visible": "[equals(steps('regCnt').regionCnt, 3)]"
              }
            ],
            "visible": "[equals(steps('regCnt').regionCnt, 3)]"
          },
          {
            "name": "managedDiskType",
            "type": "Microsoft.Common.Section",
            "label": "Storage settings",
            "elements": [
              {
                "name": "mngDiskType",
                "type": "Microsoft.Common.DropDown",
                "label": "Managed disks storage type",
                "toolTip": "Managed Disks is an abstraction of current Standard and Premium storage disk in Azure Storage. You only need to specify the type (Standard or Premium) you need, in your selected Azure region, and Azure will create and manage the Disk accordingly.",
                "defaultValue": "Standard (HDD)",
                "constraints": {
                  "required": true,
                  "allowedValues": [
                    {
                      "label": "Standard (HDD)",
                      "value": "Standard_LRS"
                    },
                    {
                      "label": "Premium (SSD)",
                      "value": "Premium_LRS"
                    }
                  ]
                },
                "visible": true
              }
            ],
            "visible": true
          },
          {
            "name": "vmSizeSelector",
            "type": "Microsoft.Common.Section",
            "label": "Virtual machine size",
            "visible": true,
            "elements": [
              {
                "name": "generatorVmSizeHDD",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Block Generator virtual machine size",
                "recommendedSizes": [
                  "Standard_D1_v2",
                  "Standard_D2_v2",
                  "Standard_D3_v2"
                ],
                "constraints": {
                  "allowedSizes": [
                    "Standard_A1",
                    "Standard_A2",
                    "Standard_A3",
                    "Standard_A4",
                    "Standard_A5",
                    "Standard_A6",
                    "Standard_A7",
                    "Standard_A1_v2",
                    "Standard_A2_v2",
                    "Standard_A4_v2",
                    "Standard_A8_v2",
                    "Standard_A2m_v2",
                    "Standard_A4m_v2",
                    "Standard_A8m_v2",
                    "Standard_D1",
                    "Standard_D2",
                    "Standard_D3",
                    "Standard_D4",
                    "Standard_D1_v2",
                    "Standard_D2_v2",
                    "Standard_D3_v2",
                    "Standard_D4_v2",
                    "Standard_D5_v2"
                  ]
                },
                "osPlatform": "Linux",
                "visible": "[equals(steps('vmCount').managedDiskType.mngDiskType, 'Standard_LRS')]"
              },
              {
                "name": "generatorVmSizeSSD",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Block Generator virtual machine size",
                "recommendedSizes": [
                  "Standard_DS1_v2",
                  "Standard_DS2_v2",
                  "Standard_DS3_v2"
                ],
                "constraints": {
                  "allowedSizes": [
                    "Standard_DS1",
                    "Standard_DS2",
                    "Standard_DS3",
                    "Standard_DS4",
                    "Standard_DS11",
                    "Standard_DS12",
                    "Standard_DS13",
                    "Standard_DS14",
                    "Standard_DS1_v2",
                    "Standard_DS2_v2",
                    "Standard_DS3_v2",
                    "Standard_DS4_v2",
                    "Standard_DS5_v2",
                    "Standard_DS11_v2",
                    "Standard_DS12_v2",
                    "Standard_DS13_v2",
                    "Standard_DS14_v2",
                    "Standard_DS15_v2"
                  ]
                },
                "osPlatform": "Linux",
                "visible": "[equals(steps('vmCount').managedDiskType.mngDiskType, 'Premium_LRS')]"
              },
              {
                "name": "signerVmSizeHDD",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Signer virtual machine size",
                "recommendedSizes": [
                  "Standard_D1_v2",
                  "Standard_D2_v2",
                  "Standard_D3_v2"
                ],
                "constraints": {
                  "allowedSizes": [
                    "Standard_A1",
                    "Standard_A2",
                    "Standard_A3",
                    "Standard_A4",
                    "Standard_A5",
                    "Standard_A6",
                    "Standard_A7",
                    "Standard_A1_v2",
                    "Standard_A2_v2",
                    "Standard_A4_v2",
                    "Standard_A8_v2",
                    "Standard_A2m_v2",
                    "Standard_A4m_v2",
                    "Standard_A8m_v2",
                    "Standard_D1",
                    "Standard_D2",
                    "Standard_D3",
                    "Standard_D4",
                    "Standard_D1_v2",
                    "Standard_D2_v2",
                    "Standard_D3_v2",
                    "Standard_D4_v2",
                    "Standard_D5_v2"
                  ]
                },
                "osPlatform": "Linux",
                "visible": "[equals(steps('vmCount').managedDiskType.mngDiskType, 'Standard_LRS')]",
                "count": "[add(steps('vmCount').vmCountReg1.signerVmCountReg1, add(mul(int(coalesce(first(steps('vmCount').vmCountReg2.signerAndParticpantVmCountReg2),0)), div(steps('regCnt').regionCnt, 2)), mul(int(coalesce(first(steps('vmCount').vmCountReg3.signerAndParticpantVmCountReg3),0)), div(steps('regCnt').regionCnt, 3))))]"
              },
              {
                "name": "signerVmSizeSSD",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Signer virtual machine size",
                "recommendedSizes": [
                  "Standard_DS1_v2",
                  "Standard_DS2_v2",
                  "Standard_DS3_v2"
                ],
                "constraints": {
                  "allowedSizes": [
                    "Standard_DS1",
                    "Standard_DS2",
                    "Standard_DS3",
                    "Standard_DS4",
                    "Standard_DS11",
                    "Standard_DS12",
                    "Standard_DS13",
                    "Standard_DS14",
                    "Standard_DS1_v2",
                    "Standard_DS2_v2",
                    "Standard_DS3_v2",
                    "Standard_DS4_v2",
                    "Standard_DS5_v2",
                    "Standard_DS11_v2",
                    "Standard_DS12_v2",
                    "Standard_DS13_v2",
                    "Standard_DS14_v2",
                    "Standard_DS15_v2"
                  ]
                },
                "osPlatform": "Linux",
                "visible": "[equals(steps('vmCount').managedDiskType.mngDiskType, 'Premium_LRS')]",
                "count": "[add(steps('vmCount').vmCountReg1.signerVmCountReg1, add(mul(int(coalesce(first(steps('vmCount').vmCountReg2.signerAndParticpantVmCountReg2),0)), div(steps('regCnt').regionCnt, 2)), mul(int(coalesce(first(steps('vmCount').vmCountReg3.signerAndParticpantVmCountReg3),0)), div(steps('regCnt').regionCnt, 3))))]"
              },
              {
                "name": "partVmSizeHDD",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Participant virtual machine size",
                "recommendedSizes": [
                  "Standard_D1_v2",
                  "Standard_D2_v2",
                  "Standard_D3_v2"
                ],
                "constraints": {
                  "allowedSizes": [
                    "Standard_A1",
                    "Standard_A2",
                    "Standard_A3",
                    "Standard_A4",
                    "Standard_A5",
                    "Standard_A6",
                    "Standard_A7",
                    "Standard_A1_v2",
                    "Standard_A2_v2",
                    "Standard_A4_v2",
                    "Standard_A8_v2",
                    "Standard_A2m_v2",
                    "Standard_A4m_v2",
                    "Standard_A8m_v2",
                    "Standard_D1",
                    "Standard_D2",
                    "Standard_D3",
                    "Standard_D4",
                    "Standard_D1_v2",
                    "Standard_D2_v2",
                    "Standard_D3_v2",
                    "Standard_D4_v2",
                    "Standard_D5_v2"
                  ]
                },
                "osPlatform": "Linux",
                "visible": "[equals(steps('vmCount').managedDiskType.mngDiskType, 'Standard_LRS')]",
                "count": "[add(steps('vmCount').vmCountReg1.partVmCountReg1, add(mul(int(coalesce(last(steps('vmCount').vmCountReg2.signerAndParticpantVmCountReg2),0)), div(steps('regCnt').regionCnt, 2)), mul(int(coalesce(last(steps('vmCount').vmCountReg3.signerAndParticpantVmCountReg3),0)), div(steps('regCnt').regionCnt, 3))))]"
              },
              {
                "name": "partVmSizeSSD",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Participant virtual machine size",
                "recommendedSizes": [
                  "Standard_DS1_v2",
                  "Standard_DS2_v2",
                  "Standard_DS3_v2"
                ],
                "constraints": {
                  "allowedSizes": [
                    "Standard_DS1",
                    "Standard_DS2",
                    "Standard_DS3",
                    "Standard_DS4",
                    "Standard_DS11",
                    "Standard_DS12",
                    "Standard_DS13",
                    "Standard_DS14",
                    "Standard_DS1_v2",
                    "Standard_DS2_v2",
                    "Standard_DS3_v2",
                    "Standard_DS4_v2",
                    "Standard_DS5_v2",
                    "Standard_DS11_v2",
                    "Standard_DS12_v2",
                    "Standard_DS13_v2",
                    "Standard_DS14_v2",
                    "Standard_DS15_v2"
                  ]
                },
                "osPlatform": "Linux",
                "visible": "[equals(steps('vmCount').managedDiskType.mngDiskType, 'Premium_LRS')]",
                "count": "[add(steps('vmCount').vmCountReg1.partVmCountReg1, add(mul(int(coalesce(last(steps('vmCount').vmCountReg2.signerAndParticpantVmCountReg2),0)), div(steps('regCnt').regionCnt, 2)), mul(int(coalesce(last(steps('vmCount').vmCountReg3.signerAndParticpantVmCountReg3),0)), div(steps('regCnt').regionCnt, 3))))]"
              }
            ]
          }
        ]
      },
      {
        "name": "otherSettings",
        "label": "Other settings",
        "bladeTitle": "Other settings",
        "subLabel": {
          "preValidation": "Required",
          "postValidation": "Done"
        },
        "elements": [
          {
            "name": "keyVaultSettings",
            "type": "Microsoft.Common.Section",
            "label": "Credential distribution via Key Vault",
            "elements": [
              {
                "name": "objId",
                "type": "Microsoft.Common.TextBox",
                "label": "Service principal's Object ID",
                "toolTip": "Refer to the deployment guide for details on where to find this ID.  This is the unique ID of the service principal that will perform credential distribution across instances via key vault. The object ID is needed to grant access to the key vault this deployment creates.",
                "constraints": {
                  "required": true
                },
                "visible": true
              },
              {
                "name": "srvPri",
                "type": "Microsoft.Common.TextBox",
                "label": "Service principal Application ID",
                "toolTip": "Refer to the deployment guide for details on where to find this ID.  The Application ID of a service principal equivalent to a user name and is used to login as the service principal from the deployed virtual machines so it can access Key Vault and perform key distribution.",
                "constraints": {
                  "required": true
                },
                "visible": true
              },
              {
                "name": "srvPriSecretKey",
                "type": "Microsoft.Common.PasswordBox",
                "label": {
                  "password": "Service principal key"
                },
                "toolTip": "Refer to the deployment guide for details on where to find this ID.  The key of a service principal is equivalent to its password and is used to login as the service principal from the deployed virtual machines so it can access Key Vault and perform key distribution.",
                "constraints": {
                  "required": true
                },
                "options": {
                  "hideConfirmation": true
                },
                "visible": true
              }
            ],
            "visible": true
          },
          {
            "name": "vnetGatewaySettings",
            "type": "Microsoft.Common.Section",
            "label": "VNet gateway settings",
            "elements": [
              {
                "name": "connectionSharedKey",
                "type": "Microsoft.Common.TextBox",
                "label": "Shared key for connections",
                "toolTip": "A mixture of letters and numbers, used to establish encryption for the connection. The same shared key must be used in both the virtual network gateways.",
                "constraints": {
                  "required": "[greaterOrEquals(steps('regCnt').regionCnt, 2)]",
                  "regex": "^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])[^\"]{5,}$",
                  "validationMessage": "Passphrase must be 5 characters or more with a minimum of 1 lower case, 1 upper case and one number. Double quotes are not allowed."
                },
                "visible": "[greaterOrEquals(steps('regCnt').regionCnt, 2)]"
              }
            ],
            "visible": "[greaterOrEquals(steps('regCnt').regionCnt, 2)]"
          }
        ]
      }
    ],
    "outputs": {
      "location": "[location()]",
      "regionCount": "[steps('regCnt').regionCnt]",
      "location_1": "[steps('regCnt').loc1]",
      "location_2": "[steps('regCnt').loc2]",
      "location_3": "[steps('regCnt').loc3]",
      "authenticationType": "[basics('basics').adminCredentials.authenticationType]",
      "adminUsername": "[basics('basics').adminUsername]",
      "adminPassword": "[basics('basics').adminCredentials.password]",
      "sshPublicKey": "[basics('basics').adminCredentials.sshPublicKey]",
      "generatorVmSize": "[coalesce(steps('vmCount').vmSizeSelector.generatorVmSizeHDD, steps('vmCount').vmSizeSelector.generatorVmSizeSSD)]",
      "signerVmSize": "[coalesce(steps('vmCount').vmSizeSelector.signerVmSizeHDD, steps('vmCount').vmSizeSelector.signerVmSizeSSD)]",
      "participantVmSize": "[coalesce(steps('vmCount').vmSizeSelector.partVmSizeHDD, steps('vmCount').vmSizeSelector.partVmSizeSSD)]",
      "signerNodeCountReg1": "[steps('vmCount').vmCountReg1.signerVmCountReg1]",
      "participantNodeCountReg1": "[steps('vmCount').vmCountReg1.partVmCountReg1]",
      "signerNodeCountReg2": "[int(coalesce(first(steps('vmCount').vmCountReg2.signerAndParticpantVmCountReg2),'0'))]",
      "participantNodeCountReg2": "[int(coalesce(last(steps('vmCount').vmCountReg2.signerAndParticpantVmCountReg2),'0'))]",
      "signerNodeCountReg3": "[int(coalesce(first(steps('vmCount').vmCountReg3.signerAndParticpantVmCountReg3),'0'))]",
      "participantNodeCountReg3": "[int(coalesce(last(steps('vmCount').vmCountReg3.signerAndParticpantVmCountReg3),'0'))]",
      "storageAccountType": "[steps('vmCount').managedDiskType.mngDiskType]",
      "VPNSharedKey": "[steps('otherSettings').vnetGatewaySettings.connectionSharedKey]",
      "objectId": "[steps('otherSettings').keyVaultSettings.objId]",
      "servicePrincipal": "[steps('otherSettings').keyVaultSettings.srvPri]",
      "secretKey": "[steps('otherSettings').keyVaultSettings.srvPriSecretKey]"
    }
  }
}
